<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta property="fb:app_id" content="1697325516979518" />
    <meta property="og:title" content="EGT Natal Chart" />
    <meta property="og:url" content="https://astro.earlgraytease.com/" />
    <meta property="og:image" content="https://astro.earlgraytease.com/natal-preview.png" />
    <meta property="og:description" content="ALPHA STATE Natal Chart generator" />
    <meta property="og:type" content="website" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script src="teleport-autocomplete.min.js"></script>
    <script src="semantic.min.js"></script>
    <script src="egtgeneric.js"></script>
    <script src="egtAstro.js"></script>
    <script src="astroEngineRender.js"></script>
    <script src="astroEngineInterpret.js"></script>
    <script src="astrodata.js"></script>
    <link rel="stylesheet" type="text/css" href="teleport-autocomplete.min.css" />
    <link rel="stylesheet" type="text/css" href="semantic.min.css" />
    <link rel="stylesheet" type="text/css" href="page.css" />
    <link rel="stylesheet" type="text/css" href="orrery.css" />
    <script>
        window.fbAsyncInit = function () {
            FB.init({
                appId: '1697325516979518',
                xfbml: true,
                version: 'v2.9'
            });
            FB.AppEvents.logPageView();
        };

        (function (d, s, id) {
            var js, fjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) {
                return;
            }
            js = d.createElement(s);
            js.id = id;
            js.src = "//connect.facebook.net/en_US/sdk.js";
            fjs.parentNode.insertBefore(js, fjs);
        }(document, 'script', 'facebook-jssdk'));
    </script>
</head>

<body>
    <div id="starbg"></div>

    <svg id="orrery" xmlns="http://www.w3.org/2000/svg">
    </svg>
    <div id="inputControls" class="ui modal">
        <div class="header">
            Create Natal Chart
        </div>
        <div class="content">
            <form class="ui form">
                <div class="field">
                    <label>Name</label>
                    <div class="field">
                        <input type="text" id="chartName" />
                    </div>
                </div>
                <div class="field">
                    <label>Birthplace</label>
                    <div class="field">
                        <input type="text" id="chartBirthplace" autocomplete="off" />
                        <input type="hidden" id="chartLatitude" />
                        <input type="hidden" id="chartLongitude" />
                        <input type="hidden" id="chartTZOffset" />
                    </div>
                </div>
                <h4 class="ui dividing header">Birth Date</h4>
                <div class="three fields">
                    <div class="field">
                        <label>Day</label>
                        <select class="ui dropdown" id="chartDateDay">
                        <option>1</option><option>2</option><option>3</option><option>4</option><option>5</option><option>6</option><option>7</option><option>8</option><option>9</option><option>10</option><option>11</option><option>12</option><option>13</option><option>14</option><option>15</option><option>16</option><option>17</option><option>18</option><option>19</option><option>20</option><option>21</option><option>22</option><option>23</option><option>24</option><option>25</option><option>26</option><option>27</option><option>28</option><option>29</option><option>30</option><option>31</option>
                    </select>
                    </div>
                    <div class="field">
                        <label>Month</label>
                        <select class="ui dropdown" id="chartDateMonth">
                        <option value="1">January</option><option value="2">February</option><option value="3">March</option><option value="4">April</option><option value="5">May</option><option value="6">June</option><option value="7">July</option><option value="8">August</option><option value="9">September</option><option value="10">October</option><option value="11">November</option><option value="12">December</option>
                    </select>
                    </div>
                    <div class="field">
                        <label>Year</label>
                        <input id="chartDateYear" class="input" type="number" placeholder="year">
                    </div>
                </div>
                <div class="two fields">
                    <div class="field">
                        <label>Hour</label>
                        <select class="ui dropdown" id="chartTimeHour">
                        <option value="">Hour</option>
                        <option value="0">0</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option><option value="8">8</option><option value="9">9</option><option value="10">10</option><option value="11">11</option><option value="12">12</option><option value="13">13(1PM)</option><option value="14">14(2PM)</option><option value="15">15(3PM)</option><option value="16">16(4PM)</option><option value="17">17(5PM)</option><option value="18">18(6PM)</option><option value="19">19(7PM)</option><option value="20">20(8PM)</option><option value="21">21(9PM)</option><option value="22">22(10PM)</option><option value="23">23(11PM)</option>
                    </select>
                    </div>
                    <div class="field">
                        <label>Minute</label>
                        <select class="ui dropdown" id="chartTimeMinute">
                        <option value="">Minute</option>
                        <option value="0">0</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option><option value="8">8</option><option value="9">9</option><option value="10">10</option><option value="11">11</option><option value="12">12</option><option value="13">13</option><option value="14">14</option><option value="15">15</option><option value="16">16</option><option value="17">17</option><option value="18">18</option><option value="19">19</option><option value="20">20</option><option value="21">21</option><option value="22">22</option><option value="23">23</option><option value="24">24</option><option value="25">25</option><option value="26">26</option><option value="27">27</option><option value="28">28</option><option value="29">29</option><option value="30">30</option><option value="31">31</option><option value="32">32</option><option value="33">33</option><option value="34">34</option><option value="35">35</option><option value="36">36</option><option value="37">37</option><option value="38">38</option><option value="39">39</option><option value="40">40</option><option value="41">41</option><option value="42">42</option><option value="43">43</option><option value="44">44</option><option value="45">45</option><option value="46">46</option><option value="47">47</option><option value="48">48</option><option value="49">49</option><option value="50">50</option><option value="51">51</option><option value="52">52</option><option value="53">53</option><option value="54">54</option><option value="55">55</option><option value="56">56</option><option value="57">57</option><option value="58">58</option><option value="59">59</option>
                    </select>
                    </div>
                </div>
            </form>
        </div>
        <div id="Buttons" class="actions">
            <div class="positive ui button" id="chartButtonSubmit">
                Generate
            </div>
            <div class="ui button" id="chartButtonCancel">
                Cancel
            </div>
            <div class="ui button fb-share-button" data-href="https://astro.earlgraytease.com/" data-layout="button" data-size="small"
                data-mobile-iframe="true"><a class="fb-xfbml-parse-ignore" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fastro.earlgraytease.com%2F&amp;src=sdkpreparse">Share</a></div>
        </div>
    </div>
    <div id="interpretations">
        <div class="navb">
            <a class="nave" href="#" id="btnOpenChartModal">
                    <img src="svg/Icon-plus.svg" alt="New Chart" />
                </a>
        </div>
    </div>
    <script>
        TeleportAutocomplete.init('#chartBirthplace').on('change', function (value) {
            $('input#chartLatitude').val(value['latitude']);
            $('input#chartLongitude').val(value['longitude']);
            $('input#chartTZOffset').val(value['tzOffsetMinutes']);
            console.log(value);
        });

        var Orrery = new AstroEngineRender('#orrery');
        var OrreryInterpret = new AstroEngineInterpret('#interpretations');

        Orrery.loadData('houses', DataHouses);
        Orrery.loadData('zodiacs', DataAstroSigns);
        Orrery.loadData('planets', DataPlanets);
        Orrery.drawChartBase();

        OrreryInterpret.loadData('render', DataRender);
        OrreryInterpret.drawTable();
        for (renderKey in OrreryInterpret.DOMobjects['navbar']['objects']) {
            OrreryInterpret.DOMobjects['navbar']['objects'][renderKey]['block'].addEventListener('click', function () {
                var goKey = this.getAttribute('d');
                console.log(goKey);
                Orrery.focusOnPlanet(goKey);
                OrreryInterpret.focusOnPlanet(goKey);
            });
        }

        /*egtAstro.queryAPI(49, -123, 1987, 11, 8, 16, 30, true, 'v3beta', function (data) {
            updateChart(Orrery, OrreryInterpret, data);
        });*/

        function updateInfoBox(data, callbackOptions) {
            OrreryInterpret.updateText(callbackOptions['planet'], callbackOptions['type'], callbackOptions['header'],
                data);
        }

        function updateChart(chartObj, interpObj, data) {
            chartObj.updateChart(data);
            interpObj.updateChart(data);
        }

        function loadFromInputs(updateURL = true) {
            egtAstro.queryAPI($('input#chartLatitude').val(),
                $('input#chartLongitude').val(),
                $("#chartDateYear").val(),
                $("#chartDateMonth").val(),
                $("#chartDateDay").val(),
                $("#chartTimeHour").val(),
                $("#chartTimeMinute").val(), true, 'v3beta',
                function (data) {
                    egtGeneric.updatePageURL(data['queryString']);
                    updateChart(Orrery, OrreryInterpret, data);
                });
        }

        function loadFromGetArgs() {
            $("#chartDateDay").val(egtGeneric.getUrlParameter("day"));
            $("#chartDateMonth").val(egtGeneric.getUrlParameter("month"));
            $("#chartDateYear").val(egtGeneric.getUrlParameter("year"));
            $("#chartTimeHour").val(egtGeneric.getUrlParameter("hour"));
            $("#chartTimeMinute").val(egtGeneric.getUrlParameter("minute"));
            $("#chartName").val(egtGeneric.getUrlParameter("chartName"));

            $('input#chartLatitude').val(egtGeneric.getUrlParameter("latitude"));
            $('input#chartLongitude').val(egtGeneric.getUrlParameter("longitude"));

            loadFromInputs(false);
        }

        function chartSave(id, name, query) {
            var chartStorage = JSON.parse(localStorage.getItem("charts"));
            if (!chartStorage) {
                chartStorage = {};
            }
            chartStorage[id] = query;
            chartStorage[id]['title'] = name;
            localStorage.setItem("charts", JSON.stringify(chartStorage));
        }

        function chartLoad(id) {
            var chartStorage = JSON.parse(localStorage.getItem("charts"));
            var chartData = chartStorage[id];
            $('input#chartLatitude').val(chartData['latitude']);
            $('input#chartLongitude').val(chartData['longitude']);
            $('#chartTimeMinute').val(chartData['minute']);
            $('#chartTimeHour').val(chartData['hour']);
            $('#chartDateDay').val(chartData['day']);
            $('#chartDateMonth').val(chartData['month']);
            $('#chartDateYear').val(chartData['year']);
            $('#chartname').val(chartData['name']);
        }

        $('document').ready(function () {
            $('#inputControls').modal();
            $('#btnOpenChartModal').click(function () {
                $('#inputControls').modal('show');
            });

            loadFromGetArgs();
            $('#chartButtonSubmit').click(function () {
                $('#inputControls').modal('hide');
                loadFromInputs();
            });
        });
    </script>
</body>

</html>